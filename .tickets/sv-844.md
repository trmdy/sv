---
id: sv-844
status: closed
deps: []
links: []
created: 2026-01-01T11:34:57.535209612+01:00
type: feature
priority: 1
---
# Implement conflict tracking infrastructure (hybrid: markers + sv metadata)

Core infrastructure for tracking in-conflict commits using the hybrid approach.

## Approach
Combine conflict markers in files with sv metadata tracking:

1. **Conflict markers in files** - Commit actual `<<<<<<<`/`=======`/`>>>>>>>` markers when conflicts occur
2. **sv metadata tracking** - `.git/sv/conflicts.jsonl` tracks conflict state

## Components to Implement

### 1. ConflictRecord struct and storage
```rust
struct ConflictRecord {
    commit_id: String,
    files: Vec<String>,
    hoist_id: Option<String>,
    detected_at: DateTime<Utc>,
    resolved_at: Option<DateTime<Utc>>,
}
```

### 2. Storage methods
- `storage.append_conflict(record)`
- `storage.read_conflicts() -> Vec<ConflictRecord>`
- `storage.mark_conflict_resolved(commit_id)`
- `storage.active_conflicts() -> Vec<ConflictRecord>`

### 3. Conflict detection utilities
- `has_conflict_markers(content: &str) -> bool`
- `find_conflict_markers_in_tree(repo, commit) -> Vec<String>` (files with markers)

### 4. Integration points
- Modify `replay_commits()` to commit conflicting index instead of skipping
- Add `HoistCommitStatus::InConflict` variant
- Update `sv status` to show in-conflict commits

## Files to modify/create
- `src/conflict.rs` - new module for conflict tracking
- `src/storage.rs` - add conflicts.jsonl support  
- `src/hoist.rs` - modify replay to use conflict propagation
- `src/cli/status.rs` - show conflict warnings

## Depends on
None (foundational)

## Blocks
- sv-mor (jj-style conflict propagation in hoist)


